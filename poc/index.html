<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KidStoryBook - POC Kitap OluÅŸturucu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .form-section h2 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            display: none;
        }
        
        .result-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }
        
        .result-section h2 {
            color: #764ba2;
            margin-bottom: 15px;
        }
        
        .result-section textarea {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            min-height: 400px;
        }
        
        .copy-btn {
            margin-top: 10px;
            background: #28a745;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š KidStoryBook POC</h1>
        <p class="subtitle">10 SayfalÄ±k KiÅŸiselleÅŸtirilmiÅŸ Ã‡ocuk KitabÄ± OluÅŸturucu</p>
        
        <form id="bookForm" action="javascript:void(0);" method="post" onsubmit="return false;">
            <!-- Karakter Bilgileri -->
            <div class="form-section">
                <h2>ğŸ‘¶ Karakter Bilgileri</h2>
                
                <div class="form-group">
                    <label for="characterName">Ã‡ocuÄŸun AdÄ± *</label>
                    <input type="text" id="characterName" name="characterName" required placeholder="Ã–rn: Elif">
                </div>
                
                <div class="form-group">
                    <label for="characterAge">YaÅŸ *</label>
                    <input type="number" id="characterAge" name="characterAge" min="0" max="12" required placeholder="Ã–rn: 5">
                </div>
                
                <div class="form-group">
                    <label for="characterGender">Cinsiyet *</label>
                    <select id="characterGender" name="characterGender" required>
                        <option value="">SeÃ§iniz</option>
                        <option value="boy">Erkek</option>
                        <option value="girl">KÄ±z</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="hairColor">SaÃ§ Rengi (Opsiyonel)</label>
                    <input type="text" id="hairColor" name="hairColor" placeholder="Ã–rn: Kahverengi">
                </div>
                
                <div class="form-group">
                    <label for="eyeColor">GÃ¶z Rengi (Opsiyonel)</label>
                    <input type="text" id="eyeColor" name="eyeColor" placeholder="Ã–rn: YeÅŸil">
                </div>
                
                <div class="form-group">
                    <label>Ã–zel Ã–zellikler (Opsiyonel)</label>
                    <input type="text" id="features" name="features" placeholder="Ã–rn: gÃ¶zlÃ¼klÃ¼, Ã§illi, dimples, vb. (virgÃ¼lle ayÄ±rabilirsiniz)">
                </div>
            </div>
            
            <!-- Kitap AyarlarÄ± -->
            <div class="form-section">
                <h2>ğŸ“– Kitap AyarlarÄ±</h2>
                
                <div class="form-group">
                    <label for="aiProvider">AI Provider *</label>
                    <select id="aiProvider" name="aiProvider" required>
                        <option value="gpt">OpenAI GPT-4o</option>
                        <option value="groq">Groq (Llama 3.3)</option>
                    </select>
                    <small style="color: #666; font-size: 12px;">AI Ã§aÄŸrÄ±sÄ± yapmak iÃ§in provider seÃ§in. "Sadece Prompt HazÄ±rla" seÃ§eneÄŸi ile AI Ã§aÄŸrÄ±sÄ± yapmadan prompt'u hazÄ±rlayabilirsiniz.</small>
                </div>
                
                <div class="form-group">
                    <label for="language">Dil *</label>
                    <select id="language" name="language" required>
                        <option value="tr">TÃ¼rkÃ§e</option>
                        <option value="en">English</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="ageGroup">YaÅŸ Grubu *</label>
                    <select id="ageGroup" name="ageGroup" required>
                        <option value="">SeÃ§iniz</option>
                        <option value="0-2">0-2 YaÅŸ</option>
                        <option value="3-5">3-5 YaÅŸ</option>
                        <option value="6-9">6-9 YaÅŸ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="theme">Tema *</label>
                    <select id="theme" name="theme" required>
                        <option value="">SeÃ§iniz</option>
                        <option value="adventure">Macera</option>
                        <option value="fairy_tale">Peri MasalÄ±</option>
                        <option value="educational">EÄŸitici</option>
                        <option value="nature">DoÄŸa ve Hayvanlar</option>
                        <option value="space">Uzay ve Bilim</option>
                        <option value="sports">Spor ve Aktiviteler</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="subtheme">Alt Tema / Konu *</label>
                    <input type="text" id="subtheme" name="subtheme" required placeholder="Ã–rn: Dinozorlar, Uzay, Deniz AltÄ±">
                </div>
                
                <div class="form-group">
                    <label for="illustrationStyle">Illustration Style *</label>
                    <select id="illustrationStyle" name="illustrationStyle" required>
                        <option value="">SeÃ§iniz</option>
                        <option value="3d">3D Animation</option>
                        <option value="geometric">Geometric</option>
                        <option value="watercolor">Watercolor (Sulu Boya)</option>
                        <option value="gouache">Gouache</option>
                        <option value="picture-book">Picture-Book</option>
                        <option value="block-world">Block World</option>
                        <option value="soft-anime">Soft Anime</option>
                        <option value="collage">Collage</option>
                        <option value="clay-animation">Clay Animation</option>
                        <option value="kawaii">Kawaii</option>
                        <option value="comic-book">Comic Book</option>
                        <option value="sticker-art">Sticker Art</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="customRequests">Ã–zel Ä°stekler (Opsiyonel)</label>
                    <textarea id="customRequests" name="customRequests" placeholder="Ã–rn: Kitapta ayÄ±cÄ±k olsun, parkta top oynasÄ±nlar"></textarea>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="button" id="submitBtn" style="flex: 1;">ğŸš€ AI ile Kitap OluÅŸtur</button>
                <button type="button" id="preparePromptBtn" style="flex: 1; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">ğŸ“ Sadece Prompt HazÄ±rla</button>
            </div>
        </form>
        
        <div class="loading" id="loading">
            <p>â³ GPT-4o ile kitap iÃ§eriÄŸi oluÅŸturuluyor... LÃ¼tfen bekleyin.</p>
        </div>
        
        <div class="error" id="error"></div>
        
        <div class="result-section" id="resultSection">
            <h2>âœ… Final Prompt HazÄ±r!</h2>
            <p style="margin-bottom: 10px; color: #666;">AÅŸaÄŸÄ±daki prompt'u kopyalayÄ±p ChatGPT veya Gemini'ye gÃ¶nderin. FotoÄŸrafÄ± da eklemeyi unutmayÄ±n!</p>
            <textarea id="finalPrompt" readonly></textarea>
            <button class="copy-btn" onclick="copyPrompt()">ğŸ“‹ Prompt'u Kopyala</button>
        </div>
        
        <div class="result-section" id="promptOnlySection" style="display: none;">
            <h2>ğŸ“ Story Prompt HazÄ±r!</h2>
            <p style="margin-bottom: 10px; color: #666;" id="promptInstructions"></p>
            <textarea id="storyPrompt" readonly style="min-height: 300px;"></textarea>
            <button class="copy-btn" onclick="copyStoryPrompt()" style="margin-top: 10px;">ğŸ“‹ Story Prompt'u Kopyala</button>
            
            <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 5px;">
                <h3 style="margin-bottom: 10px; color: #0066cc;">JSON Ã‡Ä±ktÄ±sÄ±nÄ± Ekle</h3>
                <p style="margin-bottom: 10px; color: #666; font-size: 14px;">AI'dan aldÄ±ÄŸÄ±nÄ±z JSON Ã§Ä±ktÄ±sÄ±nÄ± aÅŸaÄŸÄ±ya yapÄ±ÅŸtÄ±rÄ±n:</p>
                <textarea id="jsonOutput" placeholder='{"title": "...", "pages": [...], "moral": "..."}' style="min-height: 150px; font-family: monospace; font-size: 12px;"></textarea>
                <button type="button" id="createFinalFromJsonBtn" style="margin-top: 10px; width: 100%; background: linear-gradient(135deg, #0066cc 0%, #004499 100%);">ğŸš€ Final Prompt'u OluÅŸtur</button>
            </div>
        </div>
    </div>
    
    <script>
        // Form submit yerine button click kullan
        document.getElementById('submitBtn').addEventListener('click', async function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const form = document.getElementById('bookForm');
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const resultSection = document.getElementById('resultSection');
            
            // Form validasyonu
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            // Form verilerini topla
            const formData = new FormData(form);
            const data = {
                characterName: formData.get('characterName'),
                characterAge: parseInt(formData.get('characterAge')),
                characterGender: formData.get('characterGender'),
                hairColor: formData.get('hairColor') || '',
                eyeColor: formData.get('eyeColor') || '',
                features: formData.get('features') ? formData.get('features').split(',').map(f => f.trim()).filter(f => f.length > 0) : [],
                language: formData.get('language'),
                ageGroup: formData.get('ageGroup'),
                theme: formData.get('theme'),
                subtheme: formData.get('subtheme'),
                illustrationStyle: formData.get('illustrationStyle'),
                customRequests: formData.get('customRequests') || '',
                aiProvider: formData.get('aiProvider') || 'gpt'
            };
            
            // UI gÃ¼ncelle
            submitBtn.disabled = true;
            loading.style.display = 'block';
            error.style.display = 'none';
            resultSection.style.display = 'none';
            
            try {
                console.log('ğŸ“¤ GÃ¶nderilen veri:', data);
                
                const response = await fetch('http://localhost:3001/api/create-prompt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('ğŸ“¥ Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('âŒ Sunucu hatasÄ±:', errorText);
                    throw new Error('Sunucu hatasÄ±: ' + response.statusText + ' - ' + errorText);
                }
                
                const result = await response.json();
                console.log('âœ… BaÅŸarÄ±lÄ±:', result.success);
                console.log('ğŸ“ Final prompt uzunluÄŸu:', result.finalPrompt ? result.finalPrompt.length : 0);
                
                // Final prompt'u gÃ¶ster (gÃ¼venli ÅŸekilde)
                const textarea = document.getElementById('finalPrompt');
                if (textarea && result.finalPrompt) {
                    // Textarea'ya gÃ¼venli ÅŸekilde yaz
                    textarea.value = result.finalPrompt;
                    resultSection.style.display = 'block';
                    
                    // Scroll to result
                    setTimeout(function() {
                        resultSection.scrollIntoView({ behavior: 'smooth' });
                    }, 100);
                } else {
                    console.error('âŒ Textarea veya final prompt bulunamadÄ±');
                    throw new Error('Final prompt alÄ±namadÄ± veya textarea bulunamadÄ±');
                }
                
            } catch (err) {
                console.error('âŒ Hata:', err);
                error.textContent = 'Hata: ' + err.message;
                error.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
        });
        
        // "Sadece Prompt HazÄ±rla" butonu
        document.getElementById('preparePromptBtn').addEventListener('click', async function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            console.log('ğŸ“ "Sadece Prompt HazÄ±rla" butonuna tÄ±klandÄ±');
            
            const form = document.getElementById('bookForm');
            const btn = document.getElementById('preparePromptBtn');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const promptOnlySection = document.getElementById('promptOnlySection');
            const resultSection = document.getElementById('resultSection');
            
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const formData = new FormData(form);
            const data = {
                characterName: formData.get('characterName'),
                characterAge: parseInt(formData.get('characterAge')),
                characterGender: formData.get('characterGender'),
                hairColor: formData.get('hairColor') || '',
                eyeColor: formData.get('eyeColor') || '',
                features: formData.get('features') ? formData.get('features').split(',').map(f => f.trim()).filter(f => f.length > 0) : [],
                language: formData.get('language'),
                ageGroup: formData.get('ageGroup'),
                theme: formData.get('theme'),
                subtheme: formData.get('subtheme'),
                illustrationStyle: formData.get('illustrationStyle'),
                customRequests: formData.get('customRequests') || ''
            };
            
            console.log('ğŸ“¤ GÃ¶nderilen veri (prompt hazÄ±rlama):', data);
            
            btn.disabled = true;
            loading.style.display = 'block';
            loading.innerHTML = '<p>â³ Story prompt hazÄ±rlanÄ±yor... LÃ¼tfen bekleyin.</p>';
            error.style.display = 'none';
            promptOnlySection.style.display = 'none';
            resultSection.style.display = 'none';
            
            try {
                const response = await fetch('http://localhost:3001/api/prepare-prompt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                console.log('ğŸ“¥ Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('âŒ Sunucu hatasÄ±:', errorText);
                    throw new Error('Sunucu hatasÄ±: ' + response.statusText + ' - ' + errorText);
                }
                
                const result = await response.json();
                console.log('âœ… BaÅŸarÄ±lÄ±:', result.success);
                console.log('ğŸ“ Story prompt uzunluÄŸu:', result.storyPrompt ? result.storyPrompt.length : 0);
                
                document.getElementById('storyPrompt').value = result.storyPrompt;
                document.getElementById('promptInstructions').textContent = result.instructions;
                promptOnlySection.style.display = 'block';
                
                setTimeout(() => {
                    promptOnlySection.scrollIntoView({ behavior: 'smooth' });
                }, 100);
                
            } catch (err) {
                console.error('âŒ Hata:', err);
                error.textContent = 'Hata: ' + err.message;
                error.style.display = 'block';
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        });
        
        // JSON'dan final prompt oluÅŸtur
        document.getElementById('createFinalFromJsonBtn').addEventListener('click', async function() {
            const jsonOutput = document.getElementById('jsonOutput').value;
            const form = document.getElementById('bookForm');
            const btn = document.getElementById('createFinalFromJsonBtn');
            const error = document.getElementById('error');
            const resultSection = document.getElementById('resultSection');
            
            if (!jsonOutput.trim()) {
                alert('LÃ¼tfen JSON Ã§Ä±ktÄ±sÄ±nÄ± girin!');
                return;
            }
            
            const formData = new FormData(form);
            const formDataObj = {
                characterName: formData.get('characterName'),
                characterAge: parseInt(formData.get('characterAge')),
                characterGender: formData.get('characterGender'),
                hairColor: formData.get('hairColor') || '',
                eyeColor: formData.get('eyeColor') || '',
                features: formData.get('features') ? formData.get('features').split(',').map(f => f.trim()).filter(f => f.length > 0) : [],
                language: formData.get('language'),
                ageGroup: formData.get('ageGroup'),
                theme: formData.get('theme'),
                subtheme: formData.get('subtheme'),
                illustrationStyle: formData.get('illustrationStyle'),
                customRequests: formData.get('customRequests') || ''
            };
            
            btn.disabled = true;
            error.style.display = 'none';
            
            try {
                const response = await fetch('http://localhost:3001/api/create-final-from-json', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        formData: formDataObj,
                        storyJson: jsonOutput
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error('Sunucu hatasÄ±: ' + response.statusText + ' - ' + errorText);
                }
                
                const result = await response.json();
                document.getElementById('finalPrompt').value = result.finalPrompt;
                resultSection.style.display = 'block';
                
                setTimeout(() => {
                    resultSection.scrollIntoView({ behavior: 'smooth' });
                }, 100);
                
            } catch (err) {
                console.error('âŒ Hata:', err);
                error.textContent = 'Hata: ' + err.message;
                error.style.display = 'block';
            } finally {
                btn.disabled = false;
            }
        });
        
        function copyPrompt() {
            const textarea = document.getElementById('finalPrompt');
            if (textarea) {
                textarea.select();
                document.execCommand('copy');
                alert('âœ… Prompt kopyalandÄ±! Åimdi ChatGPT veya Gemini\'ye yapÄ±ÅŸtÄ±rabilirsiniz.');
            }
        }
        
        function copyStoryPrompt() {
            const textarea = document.getElementById('storyPrompt');
            if (textarea) {
                textarea.select();
                document.execCommand('copy');
                alert('âœ… Story prompt kopyalandÄ±! Åimdi ChatGPT veya Gemini\'ye yapÄ±ÅŸtÄ±rabilirsiniz.');
            }
        }
    </script>
</body>
</html>
