<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KidStoryBook - Roadmap Viewer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 24px;
    }

    h1 {
      font-size: 28px;
      margin-bottom: 8px;
      color: #1a1a1a;
    }

    .subtitle {
      color: #666;
      margin-bottom: 12px;
    }

    .faz-title {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 24px;
      padding: 12px 16px;
      background: #f0f9ff;
      border-left: 4px solid #6366f1;
      border-radius: 4px;
    }

    .faz-title-label {
      font-size: 14px;
      font-weight: 600;
      color: #6366f1;
    }

    .faz-title-text {
      font-size: 16px;
      font-weight: 500;
      color: #1e40af;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 24px;
      padding: 16px;
      background: #f9f9f9;
      border-radius: 6px;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .control-group label {
      font-size: 12px;
      font-weight: 600;
      color: #666;
      text-transform: uppercase;
    }

    .control-group select,
    .control-group input {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .control-group input[type="text"] {
      min-width: 200px;
    }

    .file-upload {
      position: relative;
      display: inline-block;
    }

    .file-upload input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .file-upload-btn {
      padding: 10px 20px;
      background: #6366f1;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      display: inline-block;
    }

    .file-upload-btn:hover {
      background: #4f46e5;
    }

    .stats {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .stat-card {
      padding: 16px;
      background: #f9f9f9;
      border-radius: 6px;
      min-width: 150px;
    }

    .stat-card .label {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }

    .stat-card .value {
      font-size: 24px;
      font-weight: 600;
      color: #1a1a1a;
    }

    .stat-card.completed .value {
      color: #10b981;
    }

    .stat-card.pending .value {
      color: #f59e0b;
    }

    .table-container {
      overflow-x: auto;
      border: 1px solid #e5e5e5;
      border-radius: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    thead {
      background: #f9f9f9;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: #666;
      border-bottom: 2px solid #e5e5e5;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
    }

    th:hover {
      background: #f0f0f0;
    }

    th.sort-asc::after {
      content: ' ‚ñ≤';
      font-size: 10px;
    }

    th.sort-desc::after {
      content: ' ‚ñº';
      font-size: 10px;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #f0f0f0;
    }

    tr:hover {
      background: #f9f9f9;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-badge.completed {
      background: #d1fae5;
      color: #065f46;
    }

    .status-badge.pending {
      background: #fef3c7;
      color: #92400e;
    }

    .status-badge.draft {
      background: #e0e7ff;
      color: #3730a3;
    }

    .priority-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .priority-badge.critical {
      background: #fee2e2;
      color: #991b1b;
    }

    .priority-badge.important {
      background: #fef3c7;
      color: #92400e;
    }

    .priority-badge.low {
      background: #d1fae5;
      color: #065f46;
    }

    .eisenhower-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .eisenhower-badge.do {
      background: #fee2e2;
      color: #991b1b;
    }

    .eisenhower-badge.plan {
      background: #fef3c7;
      color: #92400e;
    }

    .eisenhower-badge.delegate {
      background: #fed7aa;
      color: #9a3412;
    }

    .eisenhower-badge.eliminate {
      background: #e5e7eb;
      color: #4b5563;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state h3 {
      font-size: 18px;
      margin-bottom: 8px;
      color: #666;
    }

    .empty-state p {
      font-size: 14px;
    }

    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
      }

      .control-group {
        width: 100%;
      }

      table {
        font-size: 12px;
      }

      th, td {
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä KidStoryBook Roadmap Viewer</h1>
    <p class="subtitle">CSV import edip filtreleme, sƒ±ralama ve arama yapabilirsin</p>
    <div id="fazTitle" class="faz-title" style="display: none;">
      <span class="faz-title-label">Se√ßili Faz:</span>
      <span class="faz-title-text" id="fazTitleText"></span>
    </div>

    <div class="controls">
      <div class="file-upload">
        <input type="file" id="csvFile" accept=".csv" />
        <button class="file-upload-btn">üìÅ CSV Y√ºkle</button>
      </div>

      <div class="control-group">
        <label>Durum</label>
        <select id="filterStatus">
          <option value="">T√ºm√º</option>
          <option value="Tamamlandƒ±">Tamamlandƒ±</option>
          <option value="Bekliyor">Bekliyor</option>
          <option value="Ertelendi">Ertelendi</option>
          <option value="Draft">Draft</option>
        </select>
      </div>

      <div class="control-group">
        <label>√ñncelik</label>
        <select id="filterPriority">
          <option value="">T√ºm√º</option>
          <option value="Kritik">Kritik</option>
          <option value="√ñnemli">√ñnemli</option>
          <option value="D√º≈ü√ºk">D√º≈ü√ºk</option>
        </select>
      </div>

      <div class="control-group">
        <label>Faz</label>
        <select id="filterFaz">
          <option value="">T√ºm√º</option>
          <option value="1">Faz 1</option>
          <option value="2">Faz 2</option>
          <option value="3">Faz 3</option>
          <option value="4">Faz 4</option>
          <option value="5">Faz 5</option>
          <option value="6">Faz 6</option>
        </select>
      </div>

      <div class="control-group">
        <label>Kategori</label>
        <select id="filterCategory">
          <option value="">T√ºm√º</option>
          <!-- Kategoriler CSV'den dinamik olarak y√ºklenecek -->
        </select>
      </div>

      <div class="control-group">
        <label>Eisenhower Matrisi</label>
        <select id="filterEisenhower">
          <option value="">T√ºm√º</option>
          <option value="DO">üî¥ DO (Acil ve √ñnemli)</option>
          <option value="PLAN">üü° PLAN (Acil Deƒüil ama √ñnemli)</option>
          <option value="DELEGATE">üü† DELEGATE (Acil ama √ñnemli Deƒüil)</option>
          <option value="ELIMINATE">‚ö™ ELIMINATE (Acil Deƒüil ve √ñnemli Deƒüil)</option>
        </select>
      </div>

      <div class="control-group">
        <label>Arama</label>
        <input type="text" id="searchInput" placeholder="Ba≈ülƒ±k veya notlarda ara..." />
      </div>
    </div>

    <div class="stats" id="stats" style="display: none;">
      <div class="stat-card">
        <div class="label">Toplam</div>
        <div class="value" id="statTotal">0</div>
      </div>
      <div class="stat-card completed">
        <div class="label">Tamamlanan</div>
        <div class="value" id="statCompleted">0</div>
      </div>
      <div class="stat-card pending">
        <div class="label">Bekleyen</div>
        <div class="value" id="statPending">0</div>
      </div>
      <div class="stat-card">
        <div class="label">G√∂sterilen</div>
        <div class="value" id="statFiltered">0</div>
      </div>
    </div>

    <div class="table-container">
      <table id="dataTable">
        <thead>
          <tr>
            <th data-sort="id">ID</th>
            <th data-sort="faz">Faz</th>
            <th data-sort="altFaz">Alt Faz</th>
            <th data-sort="baslik">Ba≈ülƒ±k</th>
            <th data-sort="durum">Durum</th>
            <th data-sort="oncelik">√ñncelik</th>
            <th data-sort="kategori">Kategori</th>
            <th data-sort="eisenhower">Eisenhower</th>
            <th data-sort="notlar">Notlar</th>
            <th data-sort="tarih">Tarih</th>
            <th>Link</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr>
            <td colspan="11">
              <div class="empty-state">
                <h3>üìÅ CSV Dosyasƒ± Y√ºkle</h3>
                <p>Yukarƒ±daki "CSV Y√ºkle" butonuna tƒ±klayarak roadmap.csv dosyasƒ±nƒ± y√ºkleyin</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    let allData = [];
    let filteredData = [];
    let sortColumn = null;
    let sortDirection = 'asc';

    // Faz ba≈ülƒ±klarƒ± mapping
    const fazTitles = {
      '1': 'üèóÔ∏è Faz 1: Temel Altyapƒ±',
      '2': 'üé® Faz 2: Frontend Geli≈ütirme',
      '3': '‚öôÔ∏è Faz 3: Backend ve AI Entegrasyonu',
      '4': 'üí≥ Faz 4: E-ticaret ve √ñdeme',
      '5': 'üöÄ Faz 5: Polish ve Lansman',
      '6': 'üì± Faz 6: Mobil Uygulama (PWA)'
    };

    // CSV Parse fonksiyonu
    function parseCSV(text) {
      const lines = text.split('\n').filter(line => line.trim());
      if (lines.length === 0) return [];

      const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
      const data = [];

      for (let i = 1; i < lines.length; i++) {
        const values = [];
        let current = '';
        let inQuotes = false;

        for (let j = 0; j < lines[i].length; j++) {
          const char = lines[i][j];
          
          if (char === '"') {
            if (inQuotes && lines[i][j + 1] === '"') {
              current += '"';
              j++;
            } else {
              inQuotes = !inQuotes;
            }
          } else if (char === ',' && !inQuotes) {
            values.push(current.trim());
            current = '';
          } else {
            current += char;
          }
        }
        values.push(current.trim());

        if (values.length === headers.length) {
          const row = {};
          headers.forEach((header, index) => {
            let value = values[index];
            // ID kolonundaki tab karakterini ve ="..." formatƒ±nƒ± temizle
            if (header === 'ID') {
              value = value.replace(/^\t+/, '').replace(/^="|"$/g, '').replace(/^"|"$/g, '');
            } else {
              value = value.replace(/^="|"$/g, '').replace(/^"|"$/g, '');
            }
            row[header] = value;
          });
          data.push(row);
        }
      }

      return data;
    }

    // Tablo render
    function renderTable(data) {
      const tbody = document.getElementById('tableBody');
      
      if (data.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="11">
              <div class="empty-state">
                <h3>üîç Sonu√ß Bulunamadƒ±</h3>
                <p>Filtreleri deƒüi≈ütirerek tekrar deneyin</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = data.map(row => {
        const statusClass = row.Durum === 'Tamamlandƒ±' ? 'completed' : 
                           row.Durum === 'Draft' ? 'draft' : 'pending';
        const priorityClass = row.√ñncelik === 'Kritik' ? 'critical' :
                             row.√ñncelik === '√ñnemli' ? 'important' : 'low';
        
        // Eisenhower kategorisini Priority kolonundan al (eƒüer varsa)
        const eisenhower = (row.Priority && row.Priority.trim()) ? row.Priority.trim() : null;
        const eisenhowerBadge = eisenhower ? 
          `<span class="eisenhower-badge ${eisenhower.toLowerCase()}">${getEisenhowerLabel(eisenhower)}</span>` : 
          '<span style="color: #999;">-</span>';

        return `
          <tr>
            <td>${row.ID || ''}</td>
            <td>${row.Faz || ''}</td>
            <td>${row['Alt Faz'] || ''}</td>
            <td>${row.Ba≈ülƒ±k || ''}</td>
            <td><span class="status-badge ${statusClass}">${row.Durum || ''}</span></td>
            <td><span class="priority-badge ${priorityClass}">${row.√ñncelik || ''}</span></td>
            <td>${row.Kategori || ''}</td>
            <td>${eisenhowerBadge}</td>
            <td>${row.Notlar || ''}</td>
            <td>${row.Tarih || ''}</td>
            <td>${row.Link || ''}</td>
          </tr>
        `;
      }).join('');
    }

    // Kategorileri y√ºkle (CSV'den dinamik)
    function loadCategories(data) {
      const categories = new Set();
      data.forEach(row => {
        if (row.Kategori && row.Kategori.trim()) {
          categories.add(row.Kategori.trim());
        }
      });
      
      const categorySelect = document.getElementById('filterCategory');
      // "T√ºm√º" se√ßeneƒüini koru, diƒüerlerini temizle
      categorySelect.innerHTML = '<option value="">T√ºm√º</option>';
      
      // Kategorileri alfabetik sƒ±rayla ekle
      Array.from(categories).sort().forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categorySelect.appendChild(option);
      });
    }

    // ƒ∞statistikleri g√ºncelle
    function updateStats() {
      const total = allData.length;
      const completed = allData.filter(r => r.Durum === 'Tamamlandƒ±').length;
      const pending = allData.filter(r => r.Durum === 'Bekliyor').length;
      const filtered = filteredData.length;

      document.getElementById('statTotal').textContent = total;
      document.getElementById('statCompleted').textContent = completed;
      document.getElementById('statPending').textContent = pending;
      document.getElementById('statFiltered').textContent = filtered;
      document.getElementById('stats').style.display = 'flex';
    }

    // Faz ba≈ülƒ±ƒüƒ±nƒ± g√ºncelle
    function updateFazTitle() {
      const fazFilter = document.getElementById('filterFaz').value;
      const fazTitleDiv = document.getElementById('fazTitle');
      const fazTitleText = document.getElementById('fazTitleText');

      if (fazFilter && fazTitles[fazFilter]) {
        fazTitleText.textContent = fazTitles[fazFilter];
        fazTitleDiv.style.display = 'flex';
      } else {
        fazTitleDiv.style.display = 'none';
      }
    }

    // Eisenhower kategorisini Priority kolonundan al
    function extractEisenhowerCategory(priorityValue) {
      if (!priorityValue || !priorityValue.trim()) return null;
      
      const priority = priorityValue.trim().toUpperCase();
      if (priority === 'DO') return 'DO';
      if (priority === 'PLAN') return 'PLAN';
      if (priority === 'DELEGATE') return 'DELEGATE';
      if (priority === 'ELIMINATE') return 'ELIMINATE';
      
      return null;
    }

    // Eisenhower etiketi
    function getEisenhowerLabel(category) {
      const labels = {
        'DO': 'üî¥ DO',
        'PLAN': 'üü° PLAN',
        'DELEGATE': 'üü† DELEGATE',
        'ELIMINATE': '‚ö™ ELIMINATE'
      };
      return labels[category] || category;
    }

    // Filtreleme
    function applyFilters() {
      const statusFilter = document.getElementById('filterStatus').value;
      const priorityFilter = document.getElementById('filterPriority').value;
      const fazFilter = document.getElementById('filterFaz').value;
      const categoryFilter = document.getElementById('filterCategory').value;
      const eisenhowerFilter = document.getElementById('filterEisenhower').value;
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();

      // Faz ba≈ülƒ±ƒüƒ±nƒ± g√ºncelle
      updateFazTitle();

      filteredData = allData.filter(row => {
        if (statusFilter && row.Durum !== statusFilter) return false;
        if (priorityFilter && row.√ñncelik !== priorityFilter) return false;
        if (fazFilter && row.Faz !== fazFilter) return false;
        if (categoryFilter && row.Kategori !== categoryFilter) return false;
        
        // Eisenhower filtreleme
        if (eisenhowerFilter) {
          const priorityValue = (row.Priority || '').trim();
          const eisenhower = extractEisenhowerCategory(priorityValue);
          if (eisenhower !== eisenhowerFilter) return false;
        }
        
        if (searchTerm) {
          const searchText = (row.Ba≈ülƒ±k || '') + ' ' + (row.Notlar || '');
          if (!searchText.toLowerCase().includes(searchTerm)) return false;
        }
        return true;
      });

      applySort();
      renderTable(filteredData);
      updateStats();
    }

    // Sƒ±ralama
    function applySort() {
      if (!sortColumn) return;

      filteredData.sort((a, b) => {
        let aVal, bVal;
        
        // Eisenhower i√ßin √∂zel sƒ±ralama
        if (sortColumn === 'Eisenhower') {
          const aEisenhower = extractEisenhowerCategory((a.Priority || '').trim());
          const bEisenhower = extractEisenhowerCategory((b.Priority || '').trim());
          const order = { 'DO': 1, 'PLAN': 2, 'DELEGATE': 3, 'ELIMINATE': 4 };
          aVal = aEisenhower ? order[aEisenhower] || 99 : 99;
          bVal = bEisenhower ? order[bEisenhower] || 99 : 99;
        } else {
          aVal = a[sortColumn] || '';
          bVal = b[sortColumn] || '';
        }
        
        if (sortDirection === 'asc') {
          return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
        } else {
          return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
        }
      });
    }

    // Sƒ±ralama event listener
    document.querySelectorAll('th[data-sort]').forEach(th => {
      th.addEventListener('click', () => {
        const column = th.getAttribute('data-sort');
        
        // Kolon adƒ±nƒ± header'a √ßevir
        const columnMap = {
          'id': 'ID',
          'faz': 'Faz',
          'altFaz': 'Alt Faz',
          'baslik': 'Ba≈ülƒ±k',
          'durum': 'Durum',
          'oncelik': '√ñncelik',
          'kategori': 'Kategori',
          'eisenhower': 'Eisenhower',
          'notlar': 'Notlar',
          'tarih': 'Tarih'
        };

        if (sortColumn === columnMap[column]) {
          sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
        } else {
          sortColumn = columnMap[column];
          sortDirection = 'asc';
        }

        // Sƒ±ralama i≈üaretlerini g√ºncelle
        document.querySelectorAll('th').forEach(h => {
          h.classList.remove('sort-asc', 'sort-desc');
        });
        th.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');

        applySort();
        renderTable(filteredData);
      });
    });

    // CSV y√ºkleme
    document.getElementById('csvFile').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (event) => {
        const text = event.target.result;
        allData = parseCSV(text);
        loadCategories(allData);
        applyFilters();
      };
      reader.readAsText(file, 'UTF-8');
    });

    // Filtre event listener'larƒ±
    document.getElementById('filterStatus').addEventListener('change', applyFilters);
    document.getElementById('filterPriority').addEventListener('change', applyFilters);
    document.getElementById('filterFaz').addEventListener('change', applyFilters);
    document.getElementById('filterCategory').addEventListener('change', applyFilters);
    document.getElementById('filterEisenhower').addEventListener('change', applyFilters);
    document.getElementById('searchInput').addEventListener('input', applyFilters);

    // Varsayƒ±lan CSV'yi y√ºkle (eƒüer varsa - aynƒ± klas√∂rde)
    window.addEventListener('DOMContentLoaded', () => {
      // Faz ba≈ülƒ±ƒüƒ±nƒ± ba≈ülangƒ±√ßta g√ºncelle
      updateFazTitle();
      
      fetch('./roadmap.csv')
        .then(response => {
          if (response.ok) {
            return response.text();
          }
          throw new Error('CSV bulunamadƒ±');
        })
        .then(text => {
          allData = parseCSV(text);
          loadCategories(allData);
          applyFilters();
        })
        .catch(() => {
          // CSV yoksa, kullanƒ±cƒ± manuel y√ºkleyecek
        });
    });
  </script>
</body>
</html>
